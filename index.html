<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandaty i Wnioski - Warmia RP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 700px;
            background: #161b22;
            padding: 35px 45px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
            border: 1px solid #30363d;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #58a6ff;
            font-size: 2.2em;
            letter-spacing: 1.5px;
            text-shadow: 0 0 10px rgba(88, 166, 255, 0.3);
            border-bottom: 2px solid #58a6ff;
            padding-bottom: 10px;
        }

        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        button.tab-btn {
            padding: 15px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 10px;
            background: #21262d;
            color: #8b949e;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button.tab-btn:hover {
            background: #30363d;
            color: #c9d1d9;
        }
        
        button.tab-btn.active {
            background: #58a6ff;
            color: #0d1117;
            box-shadow: 0 4px 20px rgba(88, 166, 255, 0.4);
        }

        .tab {
            display: none;
            animation: fadeIn 0.6s ease forwards;
        }

        .tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        form label {
            font-weight: 600;
            display: block;
            margin-top: 20px;
            margin-bottom: 8px;
            color: #c9d1d9;
        }

        input[type=text], input[type=number], input[type=datetime-local], input[type=time], select, textarea {
            width: 100%;
            padding: 12px 15px;
            font-size: 1em;
            border: 1px solid #30363d;
            background-color: #21262d;
            color: #c9d1d9;
            border-radius: 10px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        input[type=text]:focus, input[type=number]:focus, input[type=datetime-local]:focus, input[type=time]:focus, select:focus, textarea:focus {
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
            outline: none;
        }

        input::placeholder, textarea::placeholder {
            color: #6e7681;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Poppins', sans-serif;
        }
        
        button[type=submit] {
            margin-top: 30px;
            background: linear-gradient(90deg, #38a169, #2f855a);
            border: none;
            padding: 15px 30px;
            color: white;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.4);
            transition: all 0.3s ease;
        }

        button[type=submit]:hover {
            background: linear-gradient(90deg, #2f855a, #276749);
            box-shadow: 0 6px 20px rgba(56, 161, 105, 0.6);
            transform: translateY(-2px);
        }

        #statusMandat, #statusWniosek {
            margin-top: 20px;
            font-weight: 600;
            text-align: center;
            min-height: 1.5em;
            padding: 10px;
            border-radius: 8px;
        }
        
        .status-success {
            background-color: #28a74533;
            color: #28a745;
        }
        
        .status-error {
            background-color: #dc354533;
            color: #dc3545;
        }

        .line-field {
            margin: 25px 0;
            font-weight: 600;
            color: #444c56;
            text-transform: uppercase;
            letter-spacing: 1px;
            user-select: none;
        }

        .small-note {
            font-size: 0.9em;
            color: #6e7681;
            margin-top: -5px;
            margin-bottom: 15px;
        }
        
        select option {
            background-color: #21262d;
            color: #c9d1d9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mandaty i Wnioski - Warmia RP</h1>
        
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('mandat')">Wystaw Mandat</button>
            <button class="tab-btn" onclick="showTab('wniosek')">Wniosek do sądu</button>
        </div>

        <div id="mandat" class="tab active">
            <form id="mandatForm">
                <label>Imię i nazwisko ukaranego:</label>
                <input type="text" id="imie" required placeholder="np. Tomasz Malinowski" />

                <label>Nick (OOC):</label>
                <input type="text" id="nick" required placeholder="np. Malina#1122" />

                <label>Data i godzina wystawienia:</label>
                <input type="datetime-local" id="dataWystawienia" required />

                <label>Godzina zdarzenia:</label>
                <input type="time" id="godzinaZdarzenia" required />

                <label>Miejsce zdarzenia:</label>
                <input type="text" id="miejsce" required placeholder="np. Olsztyn, ul. Warszawska" />

                <label>Przyczyna nałożenia mandatu:</label>
                <select id="przyczyna" required onchange="toggleInnePole()">
                    <option value="" disabled selected>Wybierz przyczynę</option>
                    <option>Przekroczenie prędkości w terenie zabudowanym</option>
                    <option>Nieprawidłowe parkowanie</option>
                    <option>Jazda bez zapiętych pasów</option>
                    <option>Brak ważnego ubezpieczenia</option>
                    <option value="inne">Inne wykroczenie drogowe</option>
                </select>

                <div id="innePrzyczynaDiv" style="display:none;">
                    <label>Opisz inną przyczynę:</label>
                    <input type="text" id="innePrzyczyna" placeholder="Napisz dokładną przyczynę" />
                </div>

                <label>Kwota mandatu (PLN):</label>
                <input type="number" id="kwota" min="1" required placeholder="np. 5000" />

                <label>Punkty karne:</label>
                <input type="number" id="punkty" min="0" required placeholder="np. 10" />

                <label>Typ pojazdu:</label>
                <input type="text" id="pojazd" placeholder="np. Mini van" required />

                <label>Funkcjonariusz (imię i stopień):</label>
                <input type="text" id="funkcjonariusz" placeholder="np. sierż. sztab. Marek Nowak" required />

                <button type="submit">Wyślij mandat</button>
            </form>
            <div id="statusMandat"></div>
        </div>

        <div id="wniosek" class="tab">
            <form id="wniosekForm">
                <label>Imię i nazwisko ukaranego:</label>
                <input type="text" id="ukarany" required placeholder="np. Tomasz Malinowski" />

                <label>Nick (OOC):</label>
                <input type="text" id="nickWniosek" placeholder="np. Malina#1122" />

                <label>Data wystawienia mandatu:</label>
                <input type="date" id="dataMandatu" />

                <label>Typ mandatu / wykroczenia:</label>
                <input type="text" id="typMandatu" placeholder="np. Przekroczenie prędkości" />

                <label>Kwota mandatu (PLN):</label>
                <input type="number" id="kwotaMandatu" min="0" placeholder="np. 5000" />

                <label>Opis sprawy / powód wniosku:</label>
                <textarea id="powod" required placeholder="Np. Odwołanie od mandatu, wyjaśnienie okoliczności..."></textarea>

                <button type="submit">Wyślij wniosek</button>
            </form>
            <div id="statusWniosek"></div>
        </div>
    </div>
    <script>
        // Nowe webhooki od Ciebie:
        const webhookMandat = 'https://discord.com/api/webhooks/1403683432227410001/aSOQ2awWpU5bBgGsgo1E0k_kkBIGU6bwOUEBsuSXgaVc-vp3-cmAlIWk5wHSkkdLheNg';
        const webhookSadDecyzja = 'https://discord.com/api/webhooks/1403681144029057074/qWog2W1UxsgQp1P_IzmI0sqjmXtC7ZD4Fw3XsGhLX39AFaW31cyTC1Y0bNh6AfeqXy8c';
        const webhookWniosekSad = 'https://discord.com/api/webhooks/1403683863867166820/JQcyZ777-KCpdze6TrnbkHyz5vpFrqD7H1QnFAmnOoXiW_Cq_nLdmKODlzioiI-YHePO';

        // Przełączanie zakładek
        const tabs = document.querySelectorAll('.tab');
        const tabBtns = document.querySelectorAll('.tab-btn');
        function showTab(id) {
            tabs.forEach(t => t.classList.remove('active'));
            tabBtns.forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Pokaż/ukryj pole "inne przyczyna"
        function toggleInnePole() {
            const przyczyna = document.getElementById('przyczyna').value;
            document.getElementById('innePrzyczynaDiv').style.display = przyczyna === 'inne' ? 'block' : 'none';
        }

        // Funkcja wysyłająca embed do webhooka Discord
        async function wyslijWebhook(url, embed) {
            const body = JSON.stringify({ embeds: [embed] });
            const response = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: body
            });
            if(!response.ok) {
                throw new Error(`Błąd sieci: ${response.status} ${response.statusText}`);
            }
        }
        
        function setStatus(elementId, message, isSuccess) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.classList.remove('status-success', 'status-error');
            if (isSuccess !== null) {
                statusElement.classList.add(isSuccess ? 'status-success' : 'status-error');
            }
        }

        // Formularz mandatu
        document.getElementById('mandatForm').addEventListener('submit', async e => {
            e.preventDefault();
            setStatus('statusMandat', 'Wysyłam mandat...', null);

            try {
                const imie = document.getElementById('imie').value.trim();
                const nick = document.getElementById('nick').value.trim();
                const dataWystawieniaRaw = document.getElementById('dataWystawienia').value;
                const godzinaZdarzeniaRaw = document.getElementById('godzinaZdarzenia').value;
                const miejsce = document.getElementById('miejsce').value.trim();
                let przyczyna = document.getElementById('przyczyna').value;
                if (przyczyna === 'inne') {
                    const inneText = document.getElementById('innePrzyczyna').value.trim();
                    if (!inneText) {
                        setStatus('statusMandat', 'Proszę wpisać opis innej przyczyny.', false);
                        return;
                    }
                    przyczyna = inneText;
                }
                const kwota = Number(document.getElementById('kwota').value);
                const punkty = Number(document.getElementById('punkty').value);
                const pojazd = document.getElementById('pojazd').value.trim();
                const funkcjonariusz = document.getElementById('funkcjonariusz').value.trim();

                const dataObj = new Date(dataWystawieniaRaw);
                const dataStr = dataObj.toLocaleDateString('pl-PL') + ', godz. ' + dataObj.toLocaleTimeString('pl-PL', {hour: '2-digit', minute:'2-digit'});
                const godzinaZdarzenia = godzinaZdarzeniaRaw;

                const embed = {
                    title: ":money_with_wings: MANDAT KARNY",
                    description: "**Komenda Wojewódzka Policji w Olsztynie – Warmia RP**",
                    color: 0xdc143c,
                    fields: [
                        { name: '\u200b', value: `**Dane osoby ukaranej**\n> Imię i nazwisko: **${imie}**\n> Nick (OOC): ${nick}` },
                        { name: '\u200b', value: `**Informacje o zdarzeniu**\n> Data i godzina wystawienia: **${dataStr}**\n> Godzina zdarzenia: **${godzinaZdarzenia}**\n> Miejsce zdarzenia: **${miejsce}**` },
                        { name: '\u200b', value: `**Przyczyna nałożenia mandatu**\n> **${przyczyna}**` },
                        { name: '\u200b', value: `**Wymiar kary**\n> Kwota mandatu: **${kwota.toLocaleString()} PLN**\n> Punkty karne: **${punkty} pkt**` },
                        { name: '\u200b', value: `**Dane pojazdu**\n> Typ: ${pojazd}` },
                        { name: '\u200b', value: `**Funkcjonariusz wystawiający**\n> **${funkcjonariusz}**` },
                        { name: ':warning: Informacja', value: 'Mandat należy uiścić w terminie 7 dni od daty wystawienia. Brak zapłaty skutkuje wszczęciem postępowania.' },
                    ],
                    footer: { text: "Komenda Wojewódzka Policji w Olsztynie – Warmia RP" },
                    timestamp: new Date().toISOString(),
                };

                await wyslijWebhook(webhookMandat, embed);
                setStatus('statusMandat', 'Mandat został wysłany pomyślnie!', true);
                e.target.reset();
                toggleInnePole();

            } catch(err) {
                setStatus('statusMandat', 'Błąd podczas wysyłania mandatu: ' + err.message, false);
            }
        });

        // Formularz wniosku do sądu
        document.getElementById('wniosekForm').addEventListener('submit', async e => {
            e.preventDefault();
            setStatus('statusWniosek', 'Wysyłam wniosek do sądu...', null);

            try {
                const ukarany = document.getElementById('ukarany').value.trim();
                const nick = document.getElementById('nickWniosek').value.trim() || '—';
                const dataMandatu = document.getElementById('dataMandatu').value || '—';
                const typMandatu = document.getElementById('typMandatu').value.trim() || '—';
                const kwotaMandatu = document.getElementById('kwotaMandatu').value ? Number(document.getElementById('kwotaMandatu').value) : '—';
                const powod = document.getElementById('powod').value.trim();
                
                if (powod === '') {
                    setStatus('statusWniosek', 'Proszę opisać powód wniosku.', false);
                    return;
                }

                const embed = {
                    title: ":scroll: WNIOSEK DO SĄDU",
                    description: "**Komenda Wojewódzka Policji w Olsztynie – Warmia RP**",
                    color: 0x3b82f6,
                    fields: [
                        { name: '\u200b', value: `**Dane osoby ukaranej**\n> Imię i nazwisko: **${ukarany}**\n> Nick (OOC): ${nick}` },
                        { name: '\u200b', value: `**Szczegóły mandatu**\n> Data wystawienia: **${dataMandatu}**\n> Typ mandatu: **${typMandatu}**\n> Kwota mandatu: **${kwotaMandatu === '—' ? '—' : `${kwotaMandatu.toLocaleString()} PLN`}**` },
                        { name: '\u200b', value: `**Opis sprawy / powód wniosku**\n> ${powod}` },
                        { name: '\u200b', value: '\u200b', inline: false },
                        { name: ':information_source: Informacja', value: 'Decyzja sądu zostanie wysłana na kanał <#1398630915663466562>', inline: false }
                    ],
                    footer: { text: "Komenda Wojewódzka Policji w Olsztynie – Warmia RP" },
                    timestamp: new Date().toISOString(),
                };

                await wyslijWebhook(webhookWniosekSad, embed);
                setStatus('statusWniosek', 'Wniosek wysłany! Czekam na decyzję sądu...', true);
                e.target.reset();

                setTimeout(async () => {
                    try {
                        const decyzje = [
                            {
                                status: 'Wniosek rozpatrzony pozytywnie.',
                                komentarz: 'Mandat został anulowany. Proszę o zaprzestanie dalszych naruszeń prawa.',
                                kolor: 0x059669
                            },
                            {
                                status: 'Wniosek odrzucony.',
                                komentarz: 'Mandat pozostaje ważny. Proszę uiścić kwotę w terminie.',
                                kolor: 0xdc143c
                            },
                            {
                                status: 'Wniosek rozpatrzony częściowo pozytywnie.',
                                komentarz: 'Kwota mandatu została zmniejszona o 50%.',
                                kolor: 0xf59e0b
                            }
                        ];

                        const decyzja = decyzje[Math.floor(Math.random() * decyzje.length)];

                        const decyzjaEmbed = {
                            title: ":hammer: DECYZJA SĄDU",
                            description: `Wniosek dotyczący **${ukarany}** został rozpatrzony.`,
                            color: decyzja.kolor,
                            fields: [
                                { name: 'Status decyzji:', value: decyzja.status },
                                { name: 'Komentarz:', value: decyzja.komentarz }
                            ],
                            footer: { text: "Komenda Wojewódzka Policji w Olsztynie – Warmia RP" },
                            timestamp: new Date().toISOString(),
                        };

                        await wyslijWebhook(webhookSadDecyzja, decyzjaEmbed);
                        // Status na stronie nie jest tutaj zmieniany, bo decyzja idzie na Discord, nie do użytkownika
                    } catch(err) {
                        console.error('Błąd podczas wysyłania decyzji sądu:', err);
                    }
                }, 2000);

            } catch(err) {
                setStatus('statusWniosek', 'Błąd podczas wysyłania wniosku: ' + err.message, false);
            }
        });
    </script>
</body>
</html>
